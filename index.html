<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="format-detection" content="telephone=no" />  
  <!-- 1. Renamed the application. -->
  <title>Asphalt Yield Calculator</title>
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <!-- Manifest for PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192x192.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png" />
  <!-- Additional favicon format for better browser compatibility -->
  <link rel="shortcut icon" href="icons/icon-192x192.png" type="image/png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="assets/css/main.css" />

</head>
<body>
  <div class="sidebar">
    <button type="button" id="sidebarCloseButton" class="sidebar-close" aria-label="Close menu">×</button>
    <ul class="sidebar-menu">
      <li class="active primary-nav-item" data-tab="yieldTab">Yield Calc</li>
      <!-- 8. Data History Label -> Renamed -->
      <li class="primary-nav-item" data-tab="dataTab">Current Run / History</li>
      <li class="primary-nav-item" data-tab="paverSpeedTab">Paver Speed Calc</li>
      <li class="primary-nav-item" data-tab="projLengthTab">Projected Length Calc</li>
      <li class="primary-nav-item" data-tab="tonnageTab">Tonnage Calc</li>
      <!-- 13. Remove "Export All Data" -->
      <!-- <li id="exportAllDataButton">Export All Data</li> -->
      <li id="exportDataButton">Export Data</li>
      <li id="aboutButton">About</li>
      <li id="darkModeToggle" class="settings-item">Dark Mode <span class="toggle-switch" id="darkModeSwitch"></span></li>
    </ul>
  </div>
  
  <div class="overlay"></div>

  <div class="container">
    <header>
      <div class="header-pill-content">
        <div class="hamburger-menu">
          <div class="hamburger-icon">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
        <!-- Current date display -->
        <div class="current-date" id="currentDateDisplay"></div>
      </div>
    </header>
    <section class="mobile-snapshot" aria-label="Daily snapshot">
      <div class="snapshot-pill">
        <span class="snapshot-label">Run Trucks</span>
        <span class="snapshot-value" id="snapshotRunTrucks">0</span>
      </div>
      <div class="snapshot-pill">
        <span class="snapshot-label">Day Trucks</span>
        <span class="snapshot-value" id="snapshotDayTrucks">0</span>
      </div>
      <div class="snapshot-pill">
        <span class="snapshot-label">Avg Yield</span>
        <span class="snapshot-value" id="snapshotDayYield">0.00</span>
      </div>
    </section>

    <!-- Tab Navigation -->
    <div class="tab-container">
    

      <!-- ===== Yield Calculator Tab Content ===== -->
      <div class="tab-content active" id="yieldTab">
        <!-- Flex container for side-by-side layout -->
        <div class="flex-container">
          <!-- Left side: Input fields -->
          <div class="input-section">
            <div class="card-header" id="truckInfoHeader">
              <h2>Truck Information</h2>
              <span class="collapse-icon">▼</span>
            </div>
            <div class="collapsible-content" id="truckInfoContent">
              <div class="input-grid">
                <div class="form-group">
                  <label for="truckNumber">Load Number:</label>
                  <input type="number" id="truckNumber" min="0" step="1" placeholder="Enter load identifier" inputmode="numeric" pattern="[0-9]*" autocomplete="off" />
                </div>
                <div class="form-group">
                  <label for="truckTonnage">Truck Tonnage (tons):</label>
                  <input type="number" id="truckTonnage" step="0.01" min="0" placeholder="Enter tonnage" inputmode="decimal" autocomplete="off" />
                </div>
                <div class="form-group">
                  <label for="startValue">Start Sta.:</label>
                  <input type="number" id="startValue" step="0.01" min="0" placeholder="Enter start station" inputmode="decimal" autocomplete="off" />
                </div>
                <div class="form-group">
                  <label for="endValue">End Sta.:</label>
                  <input type="number" id="endValue" step="0.01" min="0" placeholder="Enter end station" inputmode="decimal" autocomplete="off" />
                </div>
                <div class="form-group">
                  <label for="width">Width (feet):</label>
                  <input type="number" id="width" step="0.01" min="0" placeholder="Enter width" inputmode="decimal" autocomplete="off" />
                </div>
                <div class="form-group">
                  <label for="calculatedLength">Calculated Length (feet):</label>
                  <input type="number" id="calculatedLength" readonly />
                </div>
              </div>
              <p class="input-helper-text">Tip: Use the keyboard Next button to move through fields faster.</p>
              <div class="entry-progress" id="entryProgress" aria-live="polite">
                <div class="entry-progress-track">
                  <span class="entry-progress-fill" id="entryProgressFill"></span>
                </div>
                <p class="entry-progress-text" id="entryProgressText">0/5 required fields complete</p>
              </div>
              <!-- Buttons below input grid -->
              <div class="button-group">
                <!-- 15. Add Undo Button -->
                <button id="undoButton" class="action-btn undo-btn" disabled>Undo Last Save</button>
                <button id="saveTruckButton" class="action-btn save-btn" disabled>Save Truck Data</button>
              </div>

              <div class="form-group">
                <label for="startValue">Start Sta.:</label>
                <input type="number" id="startValue" step="0.01" min="0" placeholder="Enter start station" inputmode="decimal" />
              </div>

              <div class="form-group">
                <label for="endValue">End Sta.:</label>
                <input type="number" id="endValue" step="0.01" min="0" placeholder="Enter end station" inputmode="decimal" />
              </div>

              <div class="form-group">
                <label for="width">Width (feet):</label>
                <input type="number" id="width" step="0.01" min="0" placeholder="Enter width" inputmode="decimal" />
              </div>

              <div class="form-group">
                <label for="calculatedLength">Calculated Length (feet):</label>
                <input type="number" id="calculatedLength" readonly />
              </div>
              
              <!-- 7. "Save Truck Data" without forcing calculation click first -->
              <button id="saveTruckButton" disabled>Save Truck Data</button>
            </div>
          </div>

          <!-- Right side: Results -->
          <div class="results-container">
            <div class="current-results">
              <h2>Current Truck Results</h2>
              <div class="result-row">
                <span class="result-label">Area (sq yd):</span>
                <span id="areaResult">-</span>
              </div>
              <div class="result-row">
                <span class="result-label">Weight (lbs):</span>
                <span id="weightResult">-</span>
              </div>
              <div class="result-row">
                <span class="result-label">Yield (lbs/sq yd):</span>
                <span id="yieldResult">-</span>
              </div>
            </div>

            <div class="total-results">
              <h2>Day Summary</h2>
              <div class="result-row">
                <span class="result-label">Total Trucks:</span>
                <span id="totalTrucks">0</span>
              </div>
              <div class="result-row">
                <span class="result-label">Total Area (sq yd):</span>
                <span id="totalArea">0</span>
              </div>
              <div class="result-row">
                <span class="result-label">Total Weight (lbs):</span>
                <span id="totalWeight">0</span>
              </div>
              <div class="result-row">
                <span class="result-label">Average Yield (lbs/sq yd):</span>
                <span id="averageYield">0</span>
              </div>
            </div>
            
            <div class="button-group">
              <button class="reset-btn" id="resetButton" style="background-color: var(--danger); margin: 0 auto;">
                Start New Day
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- End of Yield Calculator Tab -->

      <!-- ===== Data History Tab Content ===== -->
      <div class="tab-content" id="dataTab">
        <h2>Today's Runs</h2>
        <p class="table-mobile-guide">Mobile view shows each load as a card. Use <strong>Edit Table</strong> when you need row-by-row edits.</p>
        <div id="truckDataCards" aria-live="polite"></div>
        <div class="data-table-container">
          <table class="truck-data-table" id="truckDataTable">
            <thead>
              <tr>
                <th>Load #</th>
                <th>Start Sta.</th>
                <th>End Sta.</th>
                <th>Length (ft)</th>
                <th>Width (ft)</th>
                <th>Area (sq yd)</th>
                <th>Tonnage</th>
                <th>Weight (lbs)</th>
                <th>Yield (lbs/sq yd)</th>
                <!-- 2. Removed Time Feature => remove "Time" column -->
                <th>Date</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="truckDataBody">
              <!-- Data appended via JavaScript -->
            </tbody>
            <tfoot id="truckDataFooter">
              <tr>
                <td>Totals:</td>
                <td>-</td>
                <td>-</td>
                <td id="totalLength">0.00</td>
                <td>-</td>
                <td id="totalAreaFoot">0.00</td>
                <td id="totalTonnageFoot">0.00</td>
                <td id="totalWeightFoot">0.00</td>
                <td id="avgYieldFoot">0.00</td>
                <td>-</td>
                <td>-</td>
              </tr>
            </tfoot>
          </table>
        </div>
        
        <!-- Archive Button -->
        <div class="history-actions">
          <!-- Add Edit Mode Toggle Button -->
          <button id="editModeBtn" class="action-btn btn-editable-mode" style="background-color: var(--primary); padding-top: 5px; padding-bottom: 5px;">
            Edit Table
          </button>
          <!-- 8. Rename button text -->
          <button id="viewArchivesButton" style="background-color: var(--secondary); padding-top: 5px; padding-bottom: 5px;" class="action-btn">Previous Days</button>
        </div>
        
        <!-- Archive Modal -->
        <div id="archiveModal">
          <div class="archive-modal-content">
            <span id="closeArchiveModal" class="archive-close">×</span>
            <h2>Previous Days' Run Data</h2>
            <div class="archive-filter-row">
              <select id="archiveDateSelect" style="flex-grow: 1; padding: 8px; background-color: var(--input-bg); color: var(--text-color); border: 1px solid var(--input-border); border-radius: 4px;">
                <option value="">Select a date...</option>
              </select>
            </div>
            <p class="table-mobile-guide">Mobile view shows cards for the selected day. Use <strong>Edit Table</strong> to edit archived rows.</p>
            <div id="archiveDataCards" aria-live="polite"></div>
            <!-- Remove edit controls from here -->
            <!-- 9. Display Runs within Day -> Table container takes remaining space -->
            <div class="data-table-container" style="max-height: 65vh; text-align: center;">
              <!-- 11. Improve Mobile Display -> Styles applied via CSS -->
              <table class="truck-data-table" id="archiveDataTable" style="width: 80% !important; display: inline-block !important; margin: 0 auto !important;">
                <thead>
                  <tr>
                    <th>Load #</th>
                    <th>Start Sta.</th>
                    <th>End Sta.</th>
                    <th>Length (ft)</th>
                    <th>Width (ft)</th>
                    <th>Area (sq yd)</th>
                    <th>Tonnage</th>
                    <th>Weight (lbs)</th>
                    <th>Yield (lbs/sq yd)</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="archiveDataBody">
                  <!-- Archive data will be loaded here -->
                </tbody>
                <tfoot id="archiveDataFooter">
                  <tr>
                    <td>Totals:</td>
                    <td>-</td>
                    <td>-</td>
                    <td id="archiveTotalLength">0.00</td>
                    <td>-</td>
                    <td id="archiveTotalAreaFoot">0.00</td>
                    <td id="archiveTotalTonnageFoot">0.00</td>
                    <td id="archiveTotalWeightFoot">0.00</td>
                    <td id="archiveAvgYieldFoot">0.00</td>
                    <td>-</td>
                  </tr>
                </tfoot>
              </table>
            </div>
            <!-- Move buttons below the table -->
            <div class="archive-actions">
              <!-- Add Edit Mode Toggle Button for archive modal -->
              <button id="archiveEditModeBtn" class="action-btn btn-editable-mode" style="background-color: var(--primary);">
                Edit Table
              </button>
              <!-- 13. Rename Export button -->
              <button id="exportArchiveButton" class="action-btn save-btn">Export Day</button>
            </div>
            <!-- Add edit controls here, after the buttons -->
            <div class="edit-controls" id="archiveEditControls" style="margin-top: 10px;">
              <button id="saveArchiveChangesBtn" class="action-btn save-btn">Save Changes</button>
              <button id="cancelArchiveEditingBtn" class="action-btn undo-btn">Cancel</button>
            </div>
          </div>
        </div>
      </div>
      <!-- End of Data History Tab -->

      <!-- 10. Paver Speed Calculator Tab -->
      <div class="tab-content" id="paverSpeedTab">
        <h2>Paver Speed Calculator</h2>
        <!-- V = (R_p * L) / 60, where L = (2000/9) * W * A -->
        <!-- Required Inputs: R_p, W, A -->
        <div class="flex-container">
          <div class="input-section">
            <div class="input-grid">
              <div class="form-group">
                <label for="paverProdRate">Production Rate(R/p):</label>
                <input type="number" id="paverProdRate" step="0.01" min="0" placeholder="tons/hour" inputmode="decimal" autocomplete="off" />
              </div>
              <div class="form-group">
                <label for="paverWidth">Pavement Width (W):</label>
                <input type="number" id="paverWidth" step="0.01" min="0" placeholder="feet" inputmode="decimal" autocomplete="off" />
              </div>
              <div class="form-group">
                <label for="paverYield">Application Rate (A):</label>
                <input type="number" id="paverYield" step="0.01" min="0" placeholder="lbs/sq yd" inputmode="decimal" autocomplete="off" />
              </div>
            </div>
          </div>
        </div>
        <div class="results-container">
          <div class="current-results">
            <h3>Result</h3>
            <div class="result-row">
              <span class="result-label">Paver Speed:</span>
              <span><span id="paverSpeedResult">-</span> feet/minute</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 11. Projected Paving Length Calculator Tab -->
      <div class="tab-content" id="projLengthTab">
        <h2>Projected Paving Length Calculator</h2>
        <!-- Projected Paving Length = ( Tons / ( (((LaneWidth*100)/9)*Yield) / 2000 ) ) * 100 -->
        <!-- Required Inputs: Tons, LaneWidth, Yield -->
        <div class="flex-container">
          <div class="input-section">
            <div class="input-grid">
              <div class="form-group">
                <label for="projTons">Projected Daily Tons:</label>
                <input type="number" id="projTons" step="0.01" min="0" placeholder="tons" inputmode="decimal" autocomplete="off" />
              </div>
              <div class="form-group">
                <label for="projLaneWidth">Lane Width:</label>
                <input type="number" id="projLaneWidth" step="0.01" min="0" placeholder="feet" inputmode="decimal" autocomplete="off" />
              </div>
              <div class="form-group">
                <label for="projYield">Application Rate:</label>
                <input type="number" id="projYield" step="0.01" min="0" placeholder="lbs/sq yd" inputmode="decimal" autocomplete="off" />
              </div>
            </div>
          </div>
        </div>
        <div class="results-container">
          <div class="current-results">
            <h3>Result</h3>
            <div class="result-row">
              <span class="result-label">Projected Length:</span>
              <span><span id="projLengthResult">-</span> feet</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 12. Tonnage (HMA Usage) Calculator Tab -->
      <div class="tab-content" id="tonnageTab">
        <h2>HMA Usage Calculator</h2>
        <!-- Tons Used = ((Length * Width / 9) * 110 * Depth) / 2000 -->
        <div class="flex-container">
          <div class="input-section">
            <div class="input-grid">
              <div class="form-group">
                <label for="tonLength">Length:</label>
                <input type="number" id="tonLength" step="0.01" min="0" placeholder="feet" inputmode="decimal" autocomplete="off" />
              </div>
              <div class="form-group">
                <label for="tonWidth">Width:</label>
                <input type="number" id="tonWidth" step="0.01" min="0" placeholder="feet" inputmode="decimal" autocomplete="off" />
              </div>
              <div class="form-group">
                <label for="tonDepth">Depth:</label>
                <input type="number" id="tonDepth" step="0.01" min="0" placeholder="inches" inputmode="decimal" autocomplete="off" />
              </div>
            </div>
          </div>
        </div>
        <div class="results-container">
          <div class="current-results">
            <h3>Result</h3>
            <div class="result-row">
              <span class="result-label">Estimated Tonnage:</span>
              <span><span id="tonCalcResult">-</span> tons</span>
            </div>
          </div>
        </div>
      </div>
      <!-- End of Additional Tabs -->
    </div>
    <!-- End of Tab Container -->
  </div>

  <nav id="mobileTabBar" class="mobile-tab-bar" aria-label="Primary navigation">
    <button type="button" class="mobile-tab-btn active" data-tab="yieldTab" aria-label="Yield calculator">
      <span class="mobile-tab-main">Yield</span>
    </button>
    <button type="button" class="mobile-tab-btn" data-tab="dataTab" aria-label="Current run and history">
      <span class="mobile-tab-main">History</span>
    </button>
    <button type="button" class="mobile-tab-btn" data-tab="paverSpeedTab" aria-label="Paver speed calculator">
      <span class="mobile-tab-main">Paver</span>
    </button>
    <button type="button" class="mobile-tab-btn" data-tab="projLengthTab" aria-label="Projected length calculator">
      <span class="mobile-tab-main">Length</span>
    </button>
    <button type="button" class="mobile-tab-btn" data-tab="tonnageTab" aria-label="HMA tonnage calculator">
      <span class="mobile-tab-main">Tons</span>
    </button>
  </nav>

  <!-- About Modal -->
  <div id="aboutModal" class="about-modal" style="display: none;" aria-hidden="true">
    <div class="archive-modal-content about-modal-content" role="dialog" aria-modal="true" aria-labelledby="aboutModalTitle">
      <button type="button" id="closeAboutModal" class="about-close-btn" aria-label="Close About dialog">×</button>

      <div class="about-modal-header">
        <p class="about-modal-eyebrow">HMA Paving</p>
        <h2 id="aboutModalTitle" class="about-modal-title">About and Quick Guide</h2>
        <p class="about-modal-subtitle">Built for paving crews to log loads fast, track daily production, and use field calculators with less manual math.</p>
        <div class="about-feature-grid">
          <div class="about-feature-card">
            <h3>Yield Tracking</h3>
            <p>Log trucks and get real-time run and day totals.</p>
          </div>
          <div class="about-feature-card">
            <h3>Run History</h3>
            <p>Archive runs with remarks and export by date.</p>
          </div>
          <div class="about-feature-card">
            <h3>Quick Calculators</h3>
            <p>Paver speed, projected length, and tonnage in one place.</p>
          </div>
        </div>
      </div>

      <div class="about-modal-body">
        <section class="about-section-card">
          <h3>Quick Start</h3>
          <ol class="about-list">
            <li>Enter Load Number, Tonnage, Start Sta., End Sta., and Width.</li>
            <li>Length updates automatically as you type.</li>
            <li>Tap <strong>Save Truck Data</strong> to add the load to the current run.</li>
            <li>Use <strong>Undo Last Save</strong> to remove the most recent entry.</li>
            <li>Tap <strong>Start New Run</strong> to archive the run and begin the next one.</li>
          </ol>
        </section>

        <section class="about-section-card">
          <h3>Tools</h3>
          <ul class="about-list">
            <li><strong>Current Run / History:</strong> Review the current run table and totals.</li>
            <li><strong>Archived Runs:</strong> Select a date to view completed runs and daily totals.</li>
            <li><strong>Export Day (Excel):</strong> Download an `.xlsx` file for the selected date.</li>
            <li><strong>Paver Speed:</strong> Compute feet/min from production, width, and application rate.</li>
            <li><strong>Projected Length:</strong> Estimate paving length from planned daily tonnage.</li>
            <li><strong>Tonnage:</strong> Estimate HMA tons from length, width, and depth.</li>
          </ul>
        </section>

        <section class="about-section-card">
          <h3>Data and Device Notes</h3>
          <ul class="about-list">
            <li>All data is stored locally in your browser on this device.</li>
            <li>Clearing browser storage removes saved data.</li>
            <li>Day summaries reset at midnight based on device time.</li>
            <li>Auto-fill for Start Sta. can be toggled in <strong>Settings</strong>.</li>
          </ul>
        </section>

        <section class="about-section-card">
          <h3>Install on Home Screen</h3>
          <ul class="about-list">
            <li><strong>iOS (Safari):</strong> Share icon → <strong>Add to Home Screen</strong>.</li>
            <li><strong>Android (Chrome):</strong> Menu (three dots) → <strong>Install app</strong> or <strong>Add to Home screen</strong>.</li>
          </ul>
        </section>
      </div>

      <div class="about-modal-footer">
        <div class="about-author-meta">
          <p><strong>Created by:</strong> Mark Heinonen</p>
          <p><strong>Version:</strong> 1.2.2</p>
          <p><strong>Contact:</strong> <a href="mailto:heinonenmh@gmail.com">heinonenmh@gmail.com</a></p>
        </div>
        <div class="about-modal-actions">
          <button id="reportBugButton" type="button" class="about-btn about-btn-secondary" onclick="window.location.href='mailto:heinonenmh@gmail.com?subject=Bug Report: HMA Paving App'">Report a Bug</button>
          <button id="closeAboutButton" type="button" class="about-btn about-btn-primary">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div id="runRemarksModal" class="run-remarks-modal" aria-hidden="true">
    <div class="run-remarks-dialog" role="dialog" aria-modal="true" aria-labelledby="runRemarksTitle">
      <h3 id="runRemarksTitle">Start New Run</h3>
      <p id="runRemarksDescription"></p>
      <label for="runRemarksInput">Remarks</label>
      <textarea id="runRemarksInput" rows="3" maxlength="240" placeholder="Enter remarks or N/A"></textarea>
      <p id="runRemarksError" class="run-remarks-error" aria-live="polite"></p>
      <div class="run-remarks-actions">
        <button type="button" id="cancelRunRemarksButton" class="action-btn undo-btn">Cancel</button>
        <button type="button" id="confirmRunRemarksButton" class="action-btn save-btn">Start Run</button>
      </div>
    </div>
  </div>

  <script src="assets/js/state-and-init.js" defer></script>
  <script src="assets/js/storage-and-run.js" defer></script>
  <script src="assets/js/table-archive-export.js" defer></script>
  <script src="assets/js/calculators-ui.js" defer></script>
  <script src="assets/js/edit-mode.js" defer></script>
</body>
</html>
